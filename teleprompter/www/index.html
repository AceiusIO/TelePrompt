<!doctype html>

<html lang="en">
<head>
    <meta charset="utf-8" />
    <!-- By Aceius E. (AceiusIO) -->
    
    <!--JS-->

    <!-- JQuery -->
    <script src="/asset/js/jquery-3.5.1.min.js"></script> <!-- JQuery From Local Folder -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> <!-- JQuery From Google -->
    
    
    <!--Fancy-->
    <title>TelePrompt</title>
    
	<link href="style.css" rel="stylesheet" type="text/css" />
    <link rel="shortcut icon" href="/asset/Logo.png"></link>
</head>

<body>
	<h1 id="Header">TelePrompt</h1>
    
    <div id="scroll">
	    <div id="about">
            <p>TelePrompt is an app that allows you to write speeches and then record them in app.</p>
            <button onclick="start();" id="startbutton">Start</button>
        </div>
        
        <div id="write">
            
            <p>Enter your speech here:</p>
            <textarea cols="100" rows="25" id="speechin"></textarea><br>
            <label for="#namein">Name your speech:</label> <input type="text" value="Untitled Speech"></input>
            <button onclick="record();" id="startbutton">Finish</button>
        </div>

        <div id="record">
            <video id="video" controls></video><br>
            <button onclick="done();" id="end" event="stop">Done</button> <button onclick="recordStart();" id="RecordButton">Start Recording</button>

            <!--<h2 id="recTitle">Speech Title Goes Here</h2>-->
            <p id="recInner">Nothing Here yet. Since you got here, here's a <a href="https://www.google.com/search?q=play+snake">treat</a>!</p>
        </div>

        <div id="export">
            <p id="load">Exporting...</p>
        </div>
    </div>

    <script>
        // Initialize \\
        let speech = "The speech has not been input yet."
        let title = "The title has not been input yet."

        let shouldStop = false
        let stopped = true

        $("#scroll").hide();

        $("#Header").hide();
        $("#Header").slideDown("slow");

        $("#about").hide();
        $("#write").hide();
        $("#record").hide();
        $("#export").hide();

        $(document).ready(); {
            $("#about").slideDown("fast");
        }

        // Event Triggered Functions \\

        function start() {
            $("#about").slideUp("slow");
            $("#startbutton").slideUp("slow");
            $("#Header").slideUp("slow");
            $("#write").slideDown("slow");
        }

        function record() {
            let speechtmp = document.getElementById("speechin").value;

            //let titletmp = document.getElementById("titlein").value;

            console.log("User Speech Input: " + speechtmp);
            //console.log("User Title Input: " + titletmp);

            speech = speechtmp
            //title = titletmp

            $("#recInner").html(speech);
            $("#recTitle").html(title);
            $("#write").slideUp("slow");
            $("#record").slideDown("slow");
            

            let video = document.getElementById('video');

            
            if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: true },{ audio: true }).then(function(stream) {
                video.srcObject = stream;
                video.play();
                $("#video").slideDown("slow");
                stopped = false
            });
            }
        }

        // Recording Control \\

        const mediaRecorder = new MediaRecorder(stream, options);

        mediaRecorder.addEventListener('dataavailable', function(e) {
        if (e.data.size > 0) {
            recordedChunks.push(e.data);
        }

        if(shouldStop === true && stopped === false) {
            mediaRecorder.stop();
            stopped = true;
        }
        });

        mediaRecorder.addEventListener('stop', function() {
        downloadLink.href = URL.createObjectURL(new Blob(recordedChunks));
        downloadLink.download = 'speech.webm';
        });

        function recordStart() {
            mediaRecorder.start();
        }

        function done() {
            $("#end").slideUp("slow");
            $("#RecordButton").slideUp("slow");
            $("#video").slideUp("slow");
            $("#recInner").slideUp("slow");
            $("#export").slideDown("slow");
            shouldStop = true
        }
    </script>

</body>
</html>
